name: Upload to Hugging Face

on:
  push:
    paths:
      - 'vqvae_and_prior_training/phase_1_manual_hp_tuning/hp_commitment_cost_experiments/commitment_cost_10_first_config_to_give_100p_utilization/checkpoints/vqvae_final.pt'  # Trigger only when this file changes
    branches:
      - main  # Or your default branch

jobs:
  upload:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        lfs: true  # If using Git LFS, .....
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        pip install huggingface_hub
    
    - name: Upload to Hugging Face
      env:
        HF_TOKEN: ${{secrets.HF_TOKEN }}
      run: |
        python -c "
        from huggingface_hub import HfApi, login
        import os
        
        login(token=os.environ['HF_TOKEN'])
        api = HfApi()
        
        api.upload_file(
            path_or_fileobj='vqvae.pth',
            path_in_repo='vqvae_hf.pth',
            repo_id='shashBits/emoji_VQVAE',
            repo_type='model',
            commit_message='Auto-upload from GitHub: ${{ github.sha }}'
        )
        print('Upload successful!')
        "